<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="./Players.js"></script>
    <script src="./Bird.js"></script>
    <script src="./Accessory.js"></script>
    <script src="./Raindrop.js"></script>
    <link href="/style.css" rel="stylesheet" type="text/css" />
    <title>Bird Game</title>
  </head>
  <body class="background-image">
    <div><span id="waveNumber"><span></div>
    <img id="player1Card" src="playerCard.png" alt="Player 1 Card"/>
    <div class="player1CardText">
      <div class="nameText">Player 1</div>
      <div class="fallText"><span id="bird1-fall-count">0</span></div>
      <div class="accessory1Text"><span id="accessory1"><span></div>
      <div class="accessory2Text"><span id="accessory2"><span></div>
    </div>
    <div id="bird1-img">
      <img id="bird1" src="leftGroundBird.png" alt="Bird 1"/>
    </div>
    <img id="cloud1" src="cloudPlatform.png" alt="Cloud Platform"/>
    <div>
      <span id="saucepan"><span>
    </div>
    <div>
      <span id="bowtie"><span>
    </div>
    <div>
      <img id="raindrop1" src="rainDrop.png" alt="Rain Drop"/>
    </div>
  </body>
</html>

<style>
  .background-image {
    background-image: url("background.png");
	  background-size: cover;
  }
  .player1CardText {
    position: absolute;
    margin-left: 25px;
    font-family: verdana;
  }
  .nameText {
    margin-top: 15px;
    font-size: 24px;
  }
  .fallText {
    margin-top: 15px;
    margin-left: 100px;
    font-size: 52px;
  }
  .accessory1Text {
    margin-top: -52px;
    font-size: 12px;
  }
  .accessory2Text {
    margin-top: 18px;
    font-size: 12px;
  }
  #player1Card {
    position: absolute;
    margin-top: 10px;
    margin-left: 10px;
  }
  #bird1-img {
    position: absolute;
    left: 500px;
    top: 300px;
  }
  #cloud1 {
    position: absolute;
    left: 400px;
    top: 355px;
  }
  #saucepan {
    position: absolute;
    left: 700px;
    top: 335px;
  }
  #bowtie {
    position: absolute;
    left: 880px;
    top: 355px;
  }
  #waveNumber {
    position: absolute;
    margin-top: 10px;
    margin-left: 200px;
    font-family: verdana;
    font-size: 28px;
    font-weight: 700;
  }
  #raindrop1 {
    position: absolute;
    left: 700px;
    top: -20px;
  }
</style>

<script>
  $(document).ready(function() {
    var bird1 = new Bird("blue");
    var saucepan = true;
    var bowtie = true;
    var jumping = false;
    var right = false;
    var waveNumber = 0;
    displayAccessoriesOnGround();
    startWave()

    window.setInterval(platformCollision, 300);

    function updateWaveNumber() {
      waveNumber += 1;
      $('#waveNumber').text("Wave: " + waveNumber)
    }

    function jump() {
      if (!jumping) {
        jumping = true;
        bird1.jump();
        setTimeout(land, 900);
        direction()
      }
    }

    function land() {
      jumping = false;
      bird1.fall()
      { document.getElementById('bird1-img').style.top = bird1.y + 'px'};
      direction()
    }

    function startWave() {
      setTimeout($('#waveNumber').text("New wave starting..."), 100)
      setTimeout(updateWaveNumber, 8000)
      i = 0
      spawnTime = 9500
      while (i < 10) {
        setTimeout(spawnRaindrops, spawnTime)
        spawnTime += 3000
        i++;
        if (i === 10) {
          setTimeout(startWave, 50000)
        }
      }
    }

    function spawnRaindrops() {
      { document.getElementById('raindrop1').style.left = (Math.floor(Math.random() * (950 - 350 + 1) + 350)) + 'px'}
      $('#raindrop1').animate({top: '+=370'}, 1000);
      Math.floor(Math.random() * (950 - 350 + 1) + 350)
      setTimeout(despawnRaindrops, 1200);
    }

    function despawnRaindrops() {
      if (document.getElementById('raindrop1').style.top === '350px') {
        { document.getElementById('raindrop1').style.top = -20 + 'px'}
      }
    }

    function displayPlayerAccessories() {
      if (bird1.accessories.length > 0) {
        $('#accessory1').text(bird1.accessories[0].name.toUpperCase())
      }
      if (bird1.accessories.length > 1) {
        $('#accessory2').text(bird1.accessories[1].name.toUpperCase())
      }
    }

    function updateWornAccessories() {
      if (bird1.accessories.length > 0) {
        bird1.accessories.forEach(function(accessory) {
          if (accessory.name === 'saucepan') {
            $('#saucepan').text('')
            if (right) {
              $('#saucepan').prepend('<img id="theImg" src="saucepanRight.png" />')
              if (jumping) {
                { document.getElementById('saucepan').style.left = (bird1.x - 12) + 'px'}
              } else {
                { document.getElementById('saucepan').style.left = (bird1.x - 20) + 'px'}
              }
            } else {
              $('#saucepan').prepend('<img id="theImg" src="saucepanLeft.png" />')
              { document.getElementById('saucepan').style.left = (bird1.x + 10) + 'px'}
            }
            { document.getElementById('saucepan').style.top = (bird1.y - 12) + 'px'}
          }
          if(accessory.name === 'bowtie') {
            $('#bowtie').text('')
            if (right) {
              $('#bowtie').prepend('<img id="theImg" src="bowtieRight.png" />')
              { document.getElementById('bowtie').style.left = (bird1.x + 42) + 'px'}
            } else {
              $('#bowtie').prepend('<img id="theImg" src="bowtieLeft.png" />')
              { document.getElementById('bowtie').style.left = (bird1.x + 10) + 'px'}
            }
            { document.getElementById('bowtie').style.top = (bird1.y + 48) + 'px'}
          }
        })
      }
    }

    function displayAccessoriesOnGround() {
      if (saucepan) {
        $('#saucepan').text('')
        $('#saucepan').prepend('<img id="theImg" src="saucepanLeft.png" />')
      }
      if (bowtie) {
        $('#bowtie').text('')
        $('#bowtie').prepend('<img id="theImg" src="bowtieLeft.png" />')
      }
    }

    function accessoryCollision() {
      if (bird1.x > 640 && bird1.x < 765 && saucepan) {
        bird1.addAccessory(new Accessory('saucepan', "saucepanLeft.png", "saucepanRight.png"));
        $('#saucepan').text('')
        saucepan = false
      }
      if (bird1.x > 820 && bird1.x < 900 && bowtie) {
        bird1.addAccessory(new Accessory('bowtie', "bowtieLeft.png", "bowtieRight.png"));
        $('#bowtie').text('')
        bowtie = false
      }
      displayPlayerAccessories();
      displayAccessoriesOnGround();
      updateWornAccessories();
    }

    function platformCollision() {
      if (bird1.x > 350 && bird1.x < 950 && bird1.y >= 300) {
      } else if (!jumping) {
        if (bird1.y < 800) {
          bird1.fall();
          { document.getElementById('bird1-img').style.top = bird1.y + 'px'}
          updateWornAccessories()
        } else {
          bird1.respawn();
          bird1.increaseFallCount();
          { document.getElementById('bird1-img').style.top = bird1.y + 'px'}
          { document.getElementById('bird1-img').style.left = bird1.x + 'px'}
          updateWornAccessories()
          $('#bird1-fall-count').text(bird1.fallCount)
        }
      }
    }

    function direction() {
      if (right && jumping) {
        $('#bird1').attr("src", "rightJumpBird.png");
      } else if (right) {
        $('#bird1').attr("src", "rightGroundBird.png");
      } else if (!right && jumping) {
        $('#bird1').attr("src", "leftJumpBird.png");
      } else if (!right) {
        $('#bird1').attr("src", "leftGroundBird.png");
      }
      updateWornAccessories();
    }

    $(document).keypress(function(event){
      var key = (event.keyCode ? event.keyCode : event.which);
      var ch=String.fromCharCode(key)
      switch (ch.toLowerCase()) {
        case 'e':
          accessoryCollision();
          break;
        case 'a':
          bird1.moveLeft();
          { document.getElementById('bird1-img').style.left = bird1.x + 'px'}
          right = false;
          direction();
          break;
        case 'd':
           bird1.moveRight();
           { document.getElementById('bird1-img').style.left = bird1.x + 'px'}
           right = true;
           direction();
          break;
        case 'w':
          if (!jumping) {
            $('#bird1').attr("src", "rightJumpBird.png");
            jump();
            { document.getElementById('bird1-img').style.top = bird1.y + 'px'}
          }
          break;
        case ' ':
          if (!jumping) {
            $('#bird1').attr("src", "rightJumpBird.png");
            jump();
            { document.getElementById('bird1-img').style.top = bird1.y + 'px'}
          }
      }
    });
  });
</script>
